---
title: "【実践】Claude Code Agent Teamsで複数AIエージェントを協調させる方法"
tags:
  - AI
  - ClaudeCode
  - LLM
  - 開発効率化
  - エージェント
private: true
---

## はじめに

Claude Codeに新しく実験的機能として「Agent Teams」が追加されました。この機能を使うと、複数のClaude Codeインスタンスをチームとして協調させ、複雑なタスクを並列で処理できます。

本記事では、Agent Teamsの設定方法から実践的な活用例まで解説します。

## Agent Teamsとは

Agent Teamsは、1つのセッション（チームリード）が複数のチームメイトを生成・管理する仕組みです。各チームメイトは独自のコンテキストウィンドウを持ち、互いに直接メッセージをやり取りできます。

### サブエージェントとの違い

| 特徴 | サブエージェント | Agent Teams |
|------|------------------|-------------|
| コンテキスト | 結果は呼び出し元へ返却 | 完全に独立 |
| 通信 | メインへの報告のみ | チームメイト間で直接通信 |
| 調整 | メインが全て管理 | 共有タスクリストで自己調整 |
| トークンコスト | 低い | 高い |

## セットアップ

### 1. Agent Teamsの有効化

デフォルトでは無効なので、`settings.json`に以下を追加します：

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

### 2. 表示モードの設定

2つのモードから選択できます：

```json
{
  "teammateMode": "in-process"  // または "tmux"
}
```

- **in-process**: すべてのチームメイトがメインターミナル内で実行
- **tmux**: 各チームメイトが専用のペインを持つ（tmuxまたはiTerm2が必要）

## 実践的な活用例

### 例1: 並列コードレビュー

```
PRR #142をレビューするAgent Teamを作成してください。3人のレビュアーを生成：
- セキュリティに焦点を当てた担当
- パフォーマンス影響をチェックする担当
- テストカバレッジを検証する担当
それぞれレビューして結果を報告してください。
```

### 例2: 競合仮説によるデバッグ

```
ユーザーから「アプリが1メッセージで終了する」と報告がありました。
5つのAgentチームメイトをスポーンして異なる仮説を調査。
科学的議論のように互いの理論を反証し合ってください。
合意が得られたら結果をドキュメントに記録してください。
```

### 例3: 新機能の並列開発

```
4人のチームメイトでこれらのモジュールを並列でリファクタリング。
各チームメイトにはSonnetを使用してください。
```

## タスク管理の仕組み

共有タスクリストがチーム全体の作業を調整します：

- **pending**: 未着手
- **in progress**: 作業中
- **completed**: 完了

タスクには依存関係を設定でき、ブロックされたタスクは依存タスクが完了するまで取得できません。

## ベストプラクティス

### 1. 十分なコンテキストを提供する

チームメイトはプロジェクトコンテキスト（CLAUDE.md、MCPサーバー、スキル）を自動でロードしますが、リードの会話履歴は引き継ぎません。スポーンプロンプトにタスク固有の詳細を含めましょう。

### 2. 適切なタスクサイズを設定する

- 小さすぎると調整オーバーヘッドが効果を上回る
- 大きすぎると無駄な作業のリスクが増加
- 明確な成果物を生み出す自己完結した単位が最適

### 3. ファイル競合を避ける

2人のチームメイトが同じファイルを編集すると上書きが発生します。各チームメイトが異なるファイルセットを所有するように分割しましょう。

### 4. 進捗を監視する

チームメイトの進捗を確認し、うまくいっていないアプローチをリダイレクトしましょう。長時間放置すると無駄な作業のリスクが高まります。

## 知っておくべき制限事項

- インプロセスチームメイトではセッション再開（`/resume`）が機能しない
- セッションごとに1チームのみ作成可能
- ネストされたチーム（チームメイトが別のチームを作成）は不可
- 分割ペインモードはVS Code統合ターミナルやWindows Terminalでは非対応

## まとめ

Claude Code Agent Teamsは、並列探索が価値を生むタスクで特に効果を発揮します。コードレビュー、デバッグ、新機能開発など、複数の視点が必要な場面でぜひ活用してみてください。

まずは研究やレビューなど、コードを書かないタスクから始めることをおすすめします。

## 参考

- [Claude Code Agent Teams公式ドキュメント](https://code.claude.com/docs/en/agent-teams)
- [Claude Code サブエージェント](https://code.claude.com/docs/en/sub-agents)
